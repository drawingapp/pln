<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <title>Document</title>
    <style>
        table {
            border-collapse: collapse;
        }

        /* .tr-tbody {
            border: 1px solid black;
        }
        table, td{
            border: 1px solid black;
            text-align: center;
        } */
        .bordered td {
            border: 1px solid black;
        }
    </style>
    <script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
</head>

<body>
    <button onclick="goBack()">Kembali</button>
    <button onclick="htmlTableToExcel('xlsx')">Ekspor</button>
    <button onclick="sample('tblToExcl','tblToExcl')">Ekspor</button>
    <hr>
    <table style="width:100%" id="tblToExcl">
        <!-- col 14 -->

        <tr>
            <td></td>
            <td rowspan="2">
                <img src="./assets/logo-pln.png" alt="">
            </td>
            <td>PT PLN Persero</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td>UNIT INDUK DISTRIBUSI JAWA TENGAH & DI YOGYAKARTA</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td colspan="2">RAB TOTAL</td>
        </tr>
        <tr>
            <td></td>
            <td colspan="10" style="text-align: center;">
                RENCANA ANGGARAN BIAYA (RAB)
            </td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>Pekerjaan</td>
            <td>:</td>
            <td colspan="5" rowspan="2">PERMOHONAN PBPD KOLEKTIF PUSKESMAS SIDAREJA & PUSKESMAS BANTARSARI DAYA 99000 VA
            </td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>Lokasi</td>
            <td>:</td>
            <td colspan="5">SIDAREJA & BANTARSARI</td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>Pelaksana</td>
            <td>:</td>
            <td colspan="5">PT PLN PERSERO SIDAREJA</td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>Anggaran</td>
            <td>:</td>
            <td colspan="5">Investasi Tahun 2023</td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr></tr>

        <!-- head -->
        <tr class="bordered">
            <td rowspan="2">NO</td>
            <td rowspan="2">URAIAN</td>
            <td rowspan="2">GOL</td>
            <td rowspan="2">SAT</td>
            <td rowspan="2">VOL</td>
            <td rowspan="2">HARGA SATUAN</td>
            <td colspan="4">BIAYA YANG DIPERLUKAN (Rp)</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr class="bordered">
            <td>MDU</td>
            <td>HARDWARE</td>
            <td>JASA</td>
            <td>JUMLAH</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>

        <!-- end head -->

        <tbody id="tbody">

        </tbody>

        <tr class="bordered">
            <td></td>
            <td></td>
            <td colspan="4">Jumlah MDU - Hardware - Jasa</td>
            <td>:</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr class="bordered">
            <td></td>
            <td></td>
            <td colspan="4">PPn 10%</td>
            <td>:</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr class="bordered">
            <td></td>
            <td></td>
            <td colspan="4">Jumlah Total</td>
            <td>:</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td>0</td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr></tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td colspan="3">Paraf</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>REN</td>
            <td>JAR</td>
            <td>TEL</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </table>

    <script>

        loadObject()

        function loadObject() {            
            var shapes = JSON.parse(window.localStorage.getItem("shapes"))
            console.log(shapes)

            var tbody = document.getElementById("tbody");
            var element = ""
            if (shapes.length > 0) {
                shapes.forEach(function(value, index) {
                    console.log(value)
                    console.log(index)
                    switch (value.type) {
                        case 'rect':
                            element += `<tr class="bordered"><td>${index+1}</td><td>Kotak</td><td>IV A</td><td>Piece</td><td>1</td><td>20000</td><td>3</td><td>2</td><td>2000</td><td>3</td><td>6000</td><td></td><td></td><td></td></tr>`;
                            break;
                        case 'i-text':
                            element += `<tr class="bordered"><td>${index+1}</td><td>Text</td><td>IV A</td><td>Piece</td><td>1</td><td>20000</td><td>3</td><td>2</td><td>2000</td><td>3</td><td>6000</td><td></td><td></td><td></td></tr>`;
                            break;
                        case 'image':
                            element += `<tr class="bordered"><td>${index+1}</td><td>Logo PLN</td><td>IV A</td><td>Piece</td><td>1</td><td>20000</td><td>3</td><td>2</td><td>2000</td><td>3</td><td>6000</td><td></td><td></td><td></td></tr>`;
                            break;
                        default:
                            break;
                    }
                });
            }
            tbody.innerHTML = element

        }
        function goBack(){
            window.history.back()
        }
        function htmlTableToExcel(type) {
            var now = moment().format("DD-MM-YYYY--HH-mm-ss")            
            var data = document.getElementById('tblToExcl');
            var excelFile = XLSX.utils.table_to_book(data, { sheet: "sheet1" });
            XLSX.write(excelFile, { bookType: type, bookSST: true, type: 'base64' });
            XLSX.writeFile(excelFile, `Export-${now}.` + type);
            console.log(data)
            console.log(excelFile)
        }

        function sample(table, name) {
            
            var uri = 'data:application/vnd.ms-excel;base64,'
            var template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><?xml version="1.0" encoding="UTF-8" standalone="yes"?><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
            var base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }
            var format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }
            
            if (!table.nodeType) table = document.getElementById(table)
            var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }
            window.location.href = uri + base64(format(template, ctx))
            
        }

        function downloadLink() {
            function download_file(name, contents, mime_type) {
                mime_type = mime_type || "text/plain";

                var blob = new Blob([contents], { type: mime_type });

                var dlink = document.createElement('a');
                dlink.download = name;
                dlink.href = window.URL.createObjectURL(blob);
                dlink.onclick = function (e) {
                    // revokeObjectURL needs a delay to work properly
                    var that = this;
                    setTimeout(function () {
                        window.URL.revokeObjectURL(that.href);
                    }, 1500);
                };

                dlink.click();
                dlink.remove();
            }
        }
    </script>
</body>

</html>